<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o Escolar</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÖ</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#eef2ff', 100: '#e0e7ff', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 900: '#312e81' }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 text-slate-800 font-['Inter'] antialiased">

    <div class="app-layout flex h-[100dvh] w-screen overflow-hidden">

        <aside
            class="app-sidebar w-[260px] h-full bg-primary-900 text-white flex flex-col flex-shrink-0 z-50 transition-all duration-300 overflow-hidden shadow-2xl">
            <div class="sidebar-header h-20 flex items-center px-6 border-b border-white/10 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 bg-primary-500 rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary-500/30">
                        <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                    </div>
                    <div class="overflow-hidden">
                        <h1 class="font-bold text-lg leading-tight text-white tracking-tight truncate block"
                            title="Escola Modelo">Escola Modelo</h1>
                        <p class="text-xs text-indigo-200 font-medium">Gest√£o Acad√™mica</p>
                    </div>
                </div>
            </div>

            <nav
                class="sidebar-nav flex-1 px-2 py-4 space-y-1 overflow-y-auto scrollbar-thin scrollbar-thumb-primary-700 scrollbar-track-transparent">
                <div class="nav-group">
                    <button onclick="toggleNavGroup('group-principal')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="briefcase" class="w-5 h-5 text-indigo-300 group-hover:text-white"></i>
                            <span class="uppercase tracking-wider text-xs font-bold text-indigo-300">Principal</span>
                        </div>
                        <i data-lucide="chevron-right"
                            class="w-4 h-4 text-indigo-400 transition-transform duration-200 group-principal-icon"></i>
                    </button>
                    <div id="group-principal"
                        class="mt-1 space-y-1 overflow-hidden transition-all duration-300 max-h-[500px]">
                        <ul>
                            <li><button onclick="navigateToConfig('dashboard')"><i data-lucide="layout-dashboard"
                                        class="w-4 h-4 opacity-75"></i><span>Vis√£o Geral</span></button></li>
                            <li><button onclick="navigateToConfig('schedule')"><i data-lucide="calendar-days"
                                        class="w-4 h-4 opacity-75"></i><span>Grade Hor√°ria</span></button></li>
                            <li><button onclick="navigateToConfig('teachers')"><i data-lucide="users"
                                        class="w-4 h-4 opacity-75"></i><span>Professores</span></button></li>
                            <li><button onclick="navigateToConfig('subjects')"><i data-lucide="book-open"
                                        class="w-4 h-4 opacity-75"></i><span>Disciplinas</span></button></li>
                            <li><button onclick="navigateToConfig('classes')"><i data-lucide="graduation-cap"
                                        class="w-4 h-4 opacity-75"></i><span>Turmas</span></button></li>
                        </ul>
                    </div>
                </div>

                <div class="h-px bg-white/10 my-2 mx-3"></div>

                <div class="nav-group">
                    <button onclick="toggleNavGroup('group-admin')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="settings-2" class="w-5 h-5 text-indigo-300 group-hover:text-white"></i>
                            <span
                                class="uppercase tracking-wider text-xs font-bold text-indigo-300">Administrativo</span>
                        </div>
                        <i data-lucide="chevron-right"
                            class="w-4 h-4 text-indigo-400 transition-transform duration-200 group-admin-icon"></i>
                    </button>
                    <div id="group-admin" class="mt-1 space-y-1 overflow-hidden transition-all duration-300 max-h-0">
                        <ul>
                            <li><button onclick="navigateTo('config')"><i data-lucide="database"
                                        class="w-4 h-4 opacity-75"></i><span>Gerenciar Dados</span></button></li>
                            <li><button onclick="openResourceModal()"><i data-lucide="building-2"
                                        class="w-4 h-4 opacity-75"></i><span>Salas e Labs</span></button></li>
                            <li><button onclick="openBulkImportModal()"><i data-lucide="upload-cloud"
                                        class="w-4 h-4 opacity-75"></i><span>Importa√ß√£o Excel</span></button></li>
                            <li><button onclick="openTeacherReportModal()"><i data-lucide="file-text"
                                        class="w-4 h-4 opacity-75"></i><span>Relat√≥rio Prof.</span></button></li>
                            <li><button onclick="openClassReportModal()"><i data-lucide="file-output"
                                        class="w-4 h-4 opacity-75"></i><span>Relat√≥rio Turma</span></button></li>
                        </ul>
                    </div>
                </div>

                <div class="h-px bg-white/10 my-2 mx-3"></div>

                <div class="nav-group">
                    <button onclick="toggleNavGroup('group-teacher')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="graduation-cap" class="w-5 h-5 text-indigo-300 group-hover:text-white"></i>
                            <span class="uppercase tracking-wider text-xs font-bold text-indigo-300">Professor</span>
                        </div>
                        <i data-lucide="chevron-right"
                            class="w-4 h-4 text-indigo-400 transition-transform duration-200 group-teacher-icon"></i>
                    </button>
                    <div id="group-teacher" class="mt-1 space-y-1 overflow-hidden transition-all duration-300 max-h-0">
                        <ul>
                            <li><button><i data-lucide="clipboard-list" class="w-4 h-4 opacity-75"></i><span>Planner
                                        Pessoal</span></button></li>
                            <li><button><i data-lucide="calendar"
                                        class="w-4 h-4 opacity-75"></i><span>Calend√°rio</span></button></li>
                            <li><button><i data-lucide="check-square"
                                        class="w-4 h-4 opacity-75"></i><span>Tarefas</span></button></li>
                            <li><button><i data-lucide="sticky-note"
                                        class="w-4 h-4 opacity-75"></i><span>Anota√ß√µes</span></button></li>
                            <li><button><i data-lucide="package"
                                        class="w-4 h-4 opacity-75"></i><span>Recursos</span></button></li>
                            <li><button><i data-lucide="layout-grid"
                                        class="w-4 h-4 opacity-75"></i><span>Mapeamento</span></button></li>
                            <li><button><i data-lucide="file-question"
                                        class="w-4 h-4 opacity-75"></i><span>Provas</span></button></li>
                            <li><button><i data-lucide="book" class="w-4 h-4 opacity-75"></i><span>Consulta
                                        BNCC</span></button></li>
                        </ul>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer p-4 border-t border-white/10 bg-primary-950/20 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-400 to-purple-500 flex items-center justify-center font-bold text-white border-2 border-primary-800 shadow-md">
                        NP</div>
                    <div class="overflow-hidden">
                        <p class="text-sm font-semibold text-white truncate w-32">Professor(a)</p>
                        <p class="text-xs text-indigo-200">Coordenador(a)</p>
                    </div>
                    <button class="ml-auto text-indigo-300 hover:text-white"><i data-lucide="log-out"
                            class="w-4 h-4"></i></button>
                </div>
            </div>
        </aside>

        <main class="app-main flex-1 h-full flex flex-col bg-slate-50 relative overflow-hidden">

            <div id="view-dashboard" class="view-section active h-full overflow-y-auto p-8">
                <header class="mb-8 flex justify-between items-end">
                    <div class="min-w-0 flex-1">
                        <h2 class="text-3xl font-bold text-slate-800 truncate" title="Nome Completo">Ol√°,
                            Coordenador(a)! üëã</h2>
                        <div class="text-right hidden md:block">
                            <p class="text-sm font-medium text-slate-600" id="current-date">Carregando data...</p>
                            <p class="text-xs text-slate-400">Ano Letivo 2026</p>
                        </div>
                    </div>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div
                        class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-blue-50 text-blue-600 rounded-lg"><i data-lucide="users"
                                    class="w-6 h-6"></i></div>
                            <span
                                class="text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full">+Ativo</span>
                        </div>
                        <div>
                            <p class="text-sm text-slate-500 font-medium uppercase">Turmas</p>
                            <h3 class="text-3xl font-bold text-slate-800 mt-1" id="dash-turmas">0</h3>
                        </div>
                    </div>

                    <div
                        class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-purple-50 text-purple-600 rounded-lg"><i data-lucide="book-open"
                                    class="w-6 h-6"></i></div>
                        </div>
                        <div>
                            <p class="text-sm text-slate-500 font-medium uppercase">Aulas Cadastradas</p>
                            <h3 class="text-3xl font-bold text-slate-800 mt-1" id="dash-aulas">0</h3>
                        </div>
                    </div>

                    <div
                        class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-amber-50 text-amber-600 rounded-lg"><i data-lucide="activity"
                                    class="w-6 h-6"></i></div>
                        </div>
                        <div>
                            <p class="text-sm text-slate-500 font-medium uppercase">Status da Grade</p>
                            <h3 class="text-xl font-bold text-amber-600 mt-1" id="dash-status">Pendente</h3>
                        </div>
                    </div>

                    <div
                        class="bg-gradient-to-br from-primary-600 to-primary-800 p-6 rounded-xl shadow-lg text-white flex flex-col justify-between">
                        <div>
                            <h3 class="font-bold text-lg">Precisa gerar agora?</h3>
                            <p class="text-indigo-200 text-sm mt-1">Otimize o hor√°rio em segundos.</p>
                        </div>
                        <button onclick="navigateTo('schedule'); startGeneration()"
                            class="mt-4 bg-white text-primary-700 py-2 px-4 rounded-lg font-bold hover:bg-indigo-50 transition w-full flex items-center justify-center gap-2">
                            <i data-lucide="zap" class="w-4 h-4"></i> Gerar Hor√°rio
                        </button>
                    </div>
                </div>

                <div id="dashboardPanel" class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8 hidden">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2 text-slate-700">
                        <i data-lucide="alert-circle" class="text-amber-500"></i> Diagn√≥stico do Sistema
                    </h3>
                    <div id="alertContainer" class="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto">
                    </div>
                </div>

                <h3 class="text-lg font-bold text-slate-700 mb-4">Cadastros R√°pidos</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="navigateTo('config')"
                        class="flex items-center gap-4 p-4 bg-white border border-slate-200 rounded-xl hover:border-primary-500 hover:shadow-md transition group text-left">
                        <div
                            class="p-3 bg-indigo-50 text-indigo-600 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                            <i data-lucide="plus"></i>
                        </div>
                        <div><strong class="block text-slate-800">Nova Turma</strong><span
                                class="text-xs text-slate-500">Adicionar classe</span></div>
                    </button>
                    <button onclick="navigateTo('config')"
                        class="flex items-center gap-4 p-4 bg-white border border-slate-200 rounded-xl hover:border-primary-500 hover:shadow-md transition group text-left">
                        <div
                            class="p-3 bg-emerald-50 text-emerald-600 rounded-lg group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                            <i data-lucide="user-plus"></i>
                        </div>
                        <div><strong class="block text-slate-800">Atribuir Aula</strong><span
                                class="text-xs text-slate-500">Vincular professor</span></div>
                    </button>
                    <button onclick="openResourceModal()"
                        class="flex items-center gap-4 p-4 bg-white border border-slate-200 rounded-xl hover:border-primary-500 hover:shadow-md transition group text-left">
                        <div
                            class="p-3 bg-purple-50 text-purple-600 rounded-lg group-hover:bg-purple-600 group-hover:text-white transition-colors">
                            <i data-lucide="building-2"></i>
                        </div>
                        <div><strong class="block text-slate-800">Salas e Labs</strong><span
                                class="text-xs text-slate-500">Configurar limites</span></div>
                    </button>
                </div>
            </div>

            <div id="view-config" class="view-section h-full flex flex-col hidden bg-slate-50">
                <div
                    class="px-8 pt-8 pb-4 flex flex-col md:flex-row justify-between items-center gap-4 bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Configura√ß√µes</h2>
                        <p class="text-slate-500 text-sm">Gerencie os dados fundamentais da escola.</p>
                    </div>
                    <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                        <button onclick="switchConfigTab('subjects')" id="btn-tab-subjects"
                            class="config-tab-btn px-4 py-2 text-sm font-medium rounded-md transition-all text-slate-600 hover:text-slate-900">Disciplinas
                            & Estrutura</button>
                        <button onclick="switchConfigTab('teachers')" id="btn-tab-teachers"
                            class="config-tab-btn px-4 py-2 text-sm font-medium rounded-md transition-all text-slate-600 hover:text-slate-900">Professores</button>
                        <button onclick="switchConfigTab('classes')" id="btn-tab-classes"
                            class="config-tab-btn px-4 py-2 text-sm font-medium rounded-md transition-all text-slate-600 hover:text-slate-900">Turmas
                            & Atribui√ß√µes</button>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="exportData()" title="Backup"
                            class="p-2 border border-slate-300 rounded-lg hover:bg-slate-50 text-slate-600"><i
                                data-lucide="download" class="w-5 h-5"></i></button>
                        <button onclick="document.getElementById('importFile').click()" title="Restaurar"
                            class="p-2 border border-slate-300 rounded-lg hover:bg-slate-50 text-slate-600"><i
                                data-lucide="upload" class="w-5 h-5"></i></button>
                        <input type="file" id="importFile" class="hidden" onchange="importData(this)" accept=".json">
                        <button onclick="resetAllData()" title="Resetar Tudo"
                            class="p-2 border border-red-200 bg-red-50 text-red-600 rounded-lg hover:bg-red-100"><i
                                data-lucide="trash-2" class="w-5 h-5"></i></button>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-8 relative">
                    <div id="tab-subjects"
                        class="config-section grid grid-cols-1 xl:grid-cols-2 gap-6 max-w-6xl mx-auto hidden">
                        <div class="space-y-6">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <div class="p-4 bg-slate-50 border-b border-slate-200">
                                    <h3 class="font-bold text-slate-700 flex items-center gap-2"><i data-lucide="school"
                                            class="w-4 h-4"></i> Estrutura B√°sica</h3>
                                </div>
                                <div class="p-6 space-y-5">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Segmento de
                                            Ensino</label>
                                        <select id="schoolLevel" onchange="updateCurriculumMatrix()"
                                            class="w-full p-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none text-sm">
                                            <option value="fund1">Ensino Fundamental I</option>
                                            <option value="fund2" selected>Ensino Fundamental II (6¬∫ ao 9¬∫)</option>
                                            <option value="medio">Ensino M√©dio</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Aulas por
                                            Dia (Slots)</label>
                                        <input type="number" id="slotsPerDay" value="5" min="1" max="10"
                                            class="w-full p-2.5 border border-slate-300 rounded-lg text-sm">
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <div class="p-4 bg-slate-50 border-b border-slate-200">
                                    <h3 class="font-bold text-slate-700 flex items-center gap-2"><i data-lucide="wrench"
                                            class="w-4 h-4"></i> Ferramentas Extras</h3>
                                </div>
                                <div class="p-2">
                                    <button onclick="openResourceModal()"
                                        class="w-full text-left px-4 py-3 hover:bg-slate-50 rounded-lg text-sm font-medium text-slate-700 flex items-center gap-3 border-b border-slate-50">
                                        <div class="p-1.5 bg-purple-100 text-purple-600 rounded"><i
                                                data-lucide="building-2" class="w-4 h-4"></i></div> Configurar Salas
                                        Especiais
                                    </button>
                                    <button onclick="openBulkImportModal()"
                                        class="w-full text-left px-4 py-3 hover:bg-slate-50 rounded-lg text-sm font-medium text-slate-700 flex items-center gap-3">
                                        <div class="p-1.5 bg-green-100 text-green-600 rounded"><i
                                                data-lucide="file-spreadsheet" class="w-4 h-4"></i></div> Importa√ß√£o em
                                        Massa (Excel)
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden h-fit">
                            <div
                                class="p-4 bg-slate-50 border-b border-slate-200 flex flex-col sm:flex-row justify-between items-center gap-3">
                                <h3 class="font-bold text-slate-700 flex items-center gap-2"><i data-lucide="book-open"
                                        class="w-4 h-4"></i> Matriz Curricular</h3>
                                <div class="flex items-center gap-2 w-full sm:w-auto">
                                    <select id="bnccStageSelect"
                                        class="text-xs p-1.5 border border-slate-300 rounded focus:border-indigo-500 outline-none bg-white text-slate-700">
                                        <option value="" disabled selected>Etapa...</option>
                                        <option value="infantil">Educa√ß√£o Infantil</option>
                                        <option value="fund1">Fundamental I</option>
                                        <option value="fund2">Fundamental II</option>
                                        <option value="medio">Ensino M√©dio</option>
                                    </select>
                                    <button onclick="importBNCCSubjects()"
                                        class="text-xs bg-indigo-100 text-indigo-700 px-3 py-1.5 rounded hover:bg-indigo-200 font-bold transition flex items-center gap-1 whitespace-nowrap"><i
                                            data-lucide="download-cloud" class="w-3 h-3"></i> BNCC</button>
                                </div>
                            </div>
                            <div class="p-6">
                                <div class="flex gap-2 mb-4">
                                    <div class="flex-1"><input type="text" id="newSubjectName"
                                            placeholder="Disciplina..."
                                            class="w-full p-2.5 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 outline-none"
                                            onkeypress="handleEnter(event, addSubject)"></div>
                                    <div class="w-20"><input type="number" id="newSubjectCount" placeholder="Qtd"
                                            value="2" min="1"
                                            class="w-full p-2.5 border border-slate-300 rounded-lg text-sm text-center"
                                            title="Aulas Semanais Padr√£o"></div>
                                    <div><input type="color" id="newSubjectColor" value="#6366f1"
                                            class="h-10 w-10 cursor-pointer rounded border border-slate-200 p-1"></div>
                                    <button onclick="addSubject()"
                                        class="bg-slate-800 text-white px-3 py-2 rounded-lg hover:bg-slate-900 transition"><i
                                            data-lucide="plus" class="w-5 h-5"></i></button>
                                </div>
                                <div
                                    class="bg-slate-50 rounded-lg border border-slate-200 max-h-[400px] overflow-y-auto p-2">
                                    <div id="subjectsListContainer" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-teachers" class="config-section max-w-6xl mx-auto hidden">
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                            <div
                                class="p-6 border-b border-slate-200 flex flex-col md:flex-row justify-between items-center gap-4 bg-slate-50/50">
                                <div>
                                    <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2"><i
                                            data-lucide="users" class="w-5 h-5 text-indigo-500"></i> Corpo Docente</h3>
                                    <p class="text-sm text-slate-500">Cadastre os professores e clique neles para
                                        definir as disciplinas.</p>
                                </div>
                                <div class="flex gap-2 w-full md:w-auto">
                                    <input type="text" id="newTeacherName" placeholder="Nome do Professor..."
                                        class="flex-1 md:w-64 p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none"
                                        onkeypress="handleEnter(event, registerNewTeacher)">
                                    <button onclick="registerNewTeacher()"
                                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-indigo-700 transition flex items-center gap-2 shadow-sm"><i
                                            data-lucide="plus" class="w-5 h-5"></i> <span
                                            class="hidden md:inline">Cadastrar</span></button>
                                </div>
                            </div>
                            <div class="p-8 bg-slate-50 min-h-[400px]">
                                <div id="teachersListGrid"
                                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-classes"
                        class="config-section grid grid-cols-1 xl:grid-cols-12 gap-6 max-w-7xl mx-auto hidden">
                        <div class="xl:col-span-4 space-y-6">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden h-full">
                                <div class="p-4 bg-slate-50 border-b border-slate-200">
                                    <h3 class="font-bold text-slate-700 flex items-center gap-2"><i
                                            data-lucide="graduation-cap" class="w-4 h-4"></i> Passo 1: Turmas</h3>
                                </div>
                                <div class="p-6">
                                    <div class="flex gap-2 mb-6">
                                        <input type="text" id="classInput" placeholder="Ex: 9¬∫ Ano A"
                                            class="flex-1 p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none"
                                            onkeypress="handleEnter(event, addClass)">
                                        <button onclick="addClass()"
                                            class="bg-slate-800 text-white px-4 py-2 rounded-lg font-bold hover:bg-slate-900 transition"><i
                                                data-lucide="plus" class="w-5 h-5"></i></button>
                                    </div>
                                    <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 min-h-[300px]">
                                        <p class="text-xs font-bold text-slate-400 uppercase mb-3">Turmas Ativas</p>
                                        <div id="classList" class="flex flex-wrap gap-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="xl:col-span-8">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden h-full">
                                <div class="p-4 bg-slate-50 border-b border-slate-200">
                                    <h3 class="font-bold text-slate-700 flex items-center gap-2"><i
                                            data-lucide="user-plus" class="w-4 h-4"></i> Passo 2: Vincular Aulas</h3>
                                </div>
                                <div class="p-6">
                                    <div class="mb-6">
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">1.
                                            Selecione Turmas</label>
                                        <div id="classCheckboxes"
                                            class="flex flex-wrap gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200 min-h-[60px]">
                                            <span class="text-sm text-slate-400 italic self-center">Cadastre turmas ao
                                                lado para come√ßar.</span>
                                        </div>
                                    </div>
                                    <div
                                        class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200">
                                        <div class="md:col-span-4">
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">2.
                                                Disciplina</label>
                                            <select id="subjectSelect" onchange="updateLessonCountDisplay()"
                                                class="w-full p-2.5 border border-slate-300 rounded-lg bg-white outline-none focus:border-indigo-500"></select>
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">3.
                                                Qtd.</label>
                                            <input type="number" id="lessonCountInput" min="1" max="10"
                                                class="w-full p-2.5 bg-white border border-slate-300 rounded-lg text-center font-bold text-slate-700 focus:ring-2 focus:ring-primary-500">
                                        </div>
                                        <div class="md:col-span-4">
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">4.
                                                Professor</label>
                                            <input type="text" id="teacherInput" placeholder="Buscar..."
                                                class="w-full p-2.5 border border-slate-300 rounded-lg outline-none focus:border-indigo-500"
                                                onkeypress="handleEnter(event, addAllocation)">
                                        </div>
                                        <div class="md:col-span-2">
                                            <button onclick="addAllocation()"
                                                class="w-full bg-emerald-600 text-white p-2.5 rounded-lg font-bold hover:bg-emerald-700 shadow-sm transition active:translate-y-0.5">Vincular</button>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 mb-4 px-1">
                                        <input type="checkbox" id="allowDouble"
                                            class="w-4 h-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500">
                                        <label for="allowDouble"
                                            class="text-sm text-slate-700 font-medium cursor-pointer">Permitir aulas
                                            duplas (geminadas)</label>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Resumo das
                                            Atribui√ß√µes</label>
                                        <div id="allocationsList"
                                            class="h-64 overflow-y-auto divide-y divide-slate-100 border border-slate-200 rounded-lg bg-white">
                                            <div class="flex flex-col items-center justify-center py-8 text-slate-400">
                                                <i data-lucide="inbox" class="w-8 h-8 mb-2 opacity-50"></i>
                                                <p class="text-sm">Nenhuma aula atribu√≠da ainda.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-schedule" class="view-section h-full flex flex-col hidden bg-slate-100">
                <div
                    class="bg-white border-b border-slate-200 px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4 shadow-sm z-10">
                    <div class="flex items-center gap-4">
                        <div class="p-2 bg-primary-50 text-primary-600 rounded-lg"><i data-lucide="table-2"
                                class="w-6 h-6"></i></div>
                        <div>
                            <h2 class="text-xl font-bold text-slate-800">Grade Hor√°ria</h2>
                            <div id="statusMsg" class="text-sm font-medium h-5"></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="startBtn" onclick="startGeneration()"
                            class="bg-primary-600 text-white px-5 py-2.5 rounded-lg font-bold shadow-md hover:bg-primary-700 transition flex items-center gap-2"><i
                                data-lucide="play" class="w-4 h-4"></i> Gerar Autom√°tico</button>
                        <button id="stopBtn" onclick="stopGeneration()"
                            class="bg-red-500 text-white px-5 py-2.5 rounded-lg font-bold shadow-md hover:bg-red-600 hidden flex items-center gap-2"><i
                                data-lucide="square" class="w-4 h-4"></i> Parar</button>
                        <div class="h-8 w-px bg-slate-300 mx-2"></div>
                        <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                            <button onclick="window.print()"
                                class="p-2 text-slate-600 hover:text-primary-600 hover:bg-white rounded-md transition"
                                title="Imprimir Grade"><i data-lucide="printer" class="w-5 h-5"></i></button>
                            <button onclick="document.getElementById('printConfigModal').style.display='flex'"
                                class="p-2 text-slate-600 hover:text-primary-600 hover:bg-white rounded-md transition"
                                title="Configurar Cabe√ßalho"><i data-lucide="settings" class="w-5 h-5"></i></button>
                            <button onclick="clearSchedule()"
                                class="p-2 text-slate-600 hover:text-red-600 hover:bg-white rounded-md transition"
                                title="Limpar Tudo"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                            <button id="undoBtn" onclick="performUndo()"
                                class="p-2 text-slate-600 hover:text-primary-600 hover:bg-white rounded-md transition hidden"
                                title="Desfazer"><i data-lucide="undo-2" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                </div>

                <div class="flex-1 overflow-hidden p-6 relative">
                    <div
                        class="bg-white rounded-xl shadow-sm border border-slate-200 h-full flex flex-col overflow-hidden relative">
                        <div class="flex-1 overflow-auto p-1 relative">
                            <div id="printHeader" class="hidden print:block mb-8 text-center border-b pb-4">
                                <img id="printLogoImg" src="" class="h-20 mx-auto mb-2 hidden object-contain">
                                <h1 id="printSchoolName" class="text-3xl font-bold uppercase tracking-wide">Escola
                                    Modelo</h1>
                                <p id="printSchoolSub" class="text-lg text-gray-600 mt-1">Grade Curricular - Ano Letivo
                                    2026</p>
                            </div>
                            <table id="scheduleTable" class="w-full border-collapse"></table>
                        </div>
                        <div
                            class="bg-slate-50 border-t border-slate-200 px-4 py-2 text-xs text-slate-500 flex justify-between items-center">
                            <div class="flex gap-4">
                                <span class="flex items-center gap-1"><i data-lucide="mouse-pointer-2"
                                        class="w-3 h-3"></i> Arraste para mover</span>
                                <span class="flex items-center gap-1"><i data-lucide="lock" class="w-3 h-3"></i> Clique
                                    no cadeado para fixar</span>
                                <span class="flex items-center gap-1"><i data-lucide="edit-3" class="w-3 h-3"></i> Duplo
                                    clique para editar</span>
                            </div>
                            <div>Sistema de Gest√£o v2.0</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="loadingOverlay"
        class="fixed inset-0 bg-white/90 z-[100] hidden flex-col justify-center items-center backdrop-blur-sm">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-slate-200 border-t-primary-600 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center"><i data-lucide="zap"
                    class="w-6 h-6 text-primary-600"></i></div>
        </div>
        <p class="text-xl font-bold text-slate-800 mt-6 animate-pulse">Gerando Grade Otimizada...</p>
        <p class="text-sm text-slate-500 mt-2">O algoritmo est√° analisando milhares de combina√ß√µes.</p>
    </div>

    <div id="toast-container" class="fixed top-6 right-6 z-[2000] flex flex-col gap-3 pointer-events-none"></div>

    <div id="manualModal" class="modal-overlay hidden z-[60]">
        <div class="bg-white p-0 rounded-xl shadow-2xl w-96 overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b flex justify-between items-center">
                <h3 class="font-bold text-slate-800">Editar C√©lula</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i data-lucide="x"
                        class="w-5 h-5"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <p id="modalTargetInfo"
                    class="text-sm text-primary-600 font-medium bg-primary-50 p-2 rounded border border-primary-100 text-center">
                </p>
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Disciplina</label><select
                        id="modalSubjectSelect"
                        class="w-full p-2.5 border border-slate-300 rounded-lg outline-none focus:border-primary-500"></select>
                </div>
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Professor</label><input
                        type="text" id="modalTeacherInput"
                        class="w-full p-2.5 border border-slate-300 rounded-lg outline-none focus:border-primary-500">
                </div>
            </div>
            <div class="px-6 py-4 bg-slate-50 border-t flex justify-between">
                <button onclick="clearManualCell()" class="text-red-600 text-sm font-bold hover:underline">Limpar
                    Aula</button>
                <div class="flex gap-2">
                    <button onclick="closeModal()"
                        class="px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg font-medium">Cancelar</button>
                    <button onclick="saveManualAllocation()"
                        class="px-4 py-2 bg-primary-600 text-white rounded-lg font-bold hover:bg-primary-700">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="teacherDetailsModal" class="modal-overlay hidden z-[70]">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all">
            <div class="h-24 bg-gradient-to-r from-indigo-500 to-purple-600 relative p-6">
                <button onclick="closeTeacherDetails()" class="absolute top-4 left-4 text-white/80 hover:text-white"><i
                        data-lucide="x" class="w-6 h-6"></i></button>
                <div class="absolute -bottom-8 left-6">
                    <div class="w-16 h-16 bg-white rounded-xl shadow-md flex items-center justify-center text-2xl font-bold text-indigo-600 border-4 border-white"
                        id="teacherInitials">--</div>
                </div>
            </div>
            <div class="pt-10 px-6 pb-6">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800" id="detailTeacherName">Professor</h2>
                        <p class="text-sm text-slate-500">Gerencie as disciplinas e disponibilidade.</p>
                    </div>
                    <div class="flex flex-col items-end">
                        <label class="text-xs font-bold text-slate-400 uppercase mb-1">Cor na Grade</label>
                        <input type="color" id="detailTeacherColor" onchange="updateTeacherColor()"
                            class="h-8 w-14 cursor-pointer rounded border border-slate-200 p-0.5">
                    </div>
                </div>
                <div class="mb-6">
                    <h4 class="font-bold text-slate-700 text-sm uppercase mb-3 flex items-center gap-2"><i
                            data-lucide="book-open" class="w-4 h-4"></i> Disciplinas Habilitadas</h4>
                    <div class="bg-slate-50 rounded-lg p-4 border border-slate-200 max-h-60 overflow-y-auto">
                        <div id="teacherSubjectsList" class="space-y-2"></div>
                    </div>
                    <p class="text-xs text-slate-400 mt-2">* Marque as mat√©rias que este professor est√° apto a lecionar.
                    </p>
                </div>
                <div class="flex justify-between pt-4 border-t border-slate-100">
                    <button onclick="deleteTeacher()"
                        class="text-red-500 hover:text-red-700 text-sm font-medium flex items-center gap-1"><i
                            data-lucide="trash-2" class="w-4 h-4"></i> Excluir Professor</button>
                    <button onclick="saveTeacherDetailsFromModal()"
                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 shadow-md transition transform active:scale-95 absolute right-4 top-4 z-10">Salvar
                        Atribui√ß√µes</button>
                </div>
            </div>
        </div>
    </div>

    <div id="availabilityModal" class="modal-overlay hidden z-[60]">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden">
            <div class="px-6 py-4 border-b flex justify-between items-center bg-slate-50">
                <h3 class="font-bold text-lg">Disponibilidade: <span id="avTeacherName" class="text-primary-600"></span>
                </h3>
                <button onclick="closeAvailabilityModal()" class="text-slate-400 hover:text-slate-600"><i
                        data-lucide="x"></i></button>
            </div>
            <div class="p-6 overflow-y-auto">
                <div id="availabilityGrid" class="grid gap-1"></div>
            </div>
            <div class="px-6 py-4 border-t bg-slate-50 flex justify-end gap-2">
                <button onclick="closeAvailabilityModal()"
                    class="px-4 py-2 border rounded-lg font-medium hover:bg-slate-100">Cancelar</button>
                <button onclick="saveAvailability()"
                    class="px-4 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700">Confirmar
                    Disponibilidade</button>
            </div>
        </div>
    </div>

    <div id="printConfigModal" class="modal-overlay hidden z-[60]">
        <div class="bg-white p-6 rounded-xl shadow-xl w-96">
            <h3 class="font-bold text-lg mb-4 text-slate-800">Configurar Cabe√ßalho</h3>
            <div class="space-y-4 mb-6">
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nome da
                        Institui√ß√£o</label><input id="cfgSchoolName" placeholder="Ex: Escola Modelo"
                        class="w-full p-2 border rounded-lg"></div>
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Subt√≠tulo</label><input
                        id="cfgSchoolSub" placeholder="Ex: Hor√°rio 2026" class="w-full p-2 border rounded-lg"></div>
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Logo (Imagem)</label><input
                        type="file" id="cfgLogoInput" accept="image/*" onchange="previewLogo()" class="text-sm w-full">
                    <div class="mt-2 h-16 bg-slate-50 border border-dashed rounded flex items-center justify-center">
                        <img id="cfgLogoPreview" class="h-14 hidden object-contain"><span class="text-xs text-slate-400"
                            id="logoPlaceholder">Pr√©-visualiza√ß√£o</span>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button onclick="document.getElementById('printConfigModal').style.display='none'"
                    class="px-4 py-2 border rounded-lg hover:bg-slate-50">Cancelar</button>
                <button onclick="savePrintConfig()"
                    class="px-4 py-2 bg-primary-600 text-white rounded-lg font-bold hover:bg-primary-700">Salvar
                    Configura√ß√£o</button>
            </div>
        </div>
    </div>

    <div id="resourceModal" class="modal-overlay hidden z-[60]">
        <div class="bg-white p-6 rounded-xl shadow-xl w-96">
            <h3 class="font-bold text-lg mb-4">Salas e Laborat√≥rios</h3>
            <div id="resourceList" class="space-y-2 mb-6 max-h-60 overflow-y-auto"></div>
            <div class="flex justify-end"><button onclick="closeResourceModal()"
                    class="px-4 py-2 bg-slate-100 rounded hover:bg-slate-200 mr-2">Fechar</button><button
                    onclick="saveResources()" class="px-4 py-2 bg-primary-600 text-white rounded">Salvar</button></div>
        </div>
    </div>

    <div id="bulkImportModal" class="modal-overlay hidden z-[60]">
        <div class="bg-white p-6 rounded-xl shadow-xl max-w-2xl w-full">
            <h3 class="font-bold text-lg mb-2">Importa√ß√£o R√°pida</h3>
            <p class="text-sm text-slate-500 mb-4">Formato: TURMA, DISCIPLINA, PROFESSOR, QTD</p>
            <textarea id="bulkImportText"
                class="w-full border p-3 h-64 font-mono text-sm rounded mb-4 focus:ring-2 ring-primary-500"></textarea>
            <div class="flex justify-end gap-2"><button
                    onclick="document.getElementById('bulkImportModal').style.display='none'"
                    class="px-4 py-2 border rounded">Cancelar</button><button onclick="processBulkImport()"
                    class="px-4 py-2 bg-primary-600 text-white rounded">Processar Dados</button></div>
        </div>
    </div>

    <div id="teacherReportModal" class="modal-overlay hidden z-[60]">
        <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-5xl h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">Relat√≥rio Individual: Professor</h3><button onclick="closeReportModal()"
                    class="text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            </div>
            <div class="bg-slate-50 p-4 rounded-lg mb-4 flex gap-4 items-center">
                <select id="reportTeacherSelect" onchange="updateTeacherReportTable()"
                    class="p-2 border rounded-lg min-w-[250px]"></select>
                <button onclick="printTeacherReport()"
                    class="px-4 py-2 bg-slate-800 text-white rounded-lg flex items-center gap-2 hover:bg-slate-900"><i
                        data-lucide="printer" class="w-4 h-4"></i> Imprimir Individual</button>
            </div>
            <div class="flex-1 overflow-auto border rounded-lg">
                <table id="teacherReportTable" class="w-full text-center">
                    <thead>
                        <tr class="bg-slate-100 text-slate-600 text-sm uppercase">
                            <th>Aula</th>
                            <th>Segunda</th>
                            <th>Ter√ßa</th>
                            <th>Quarta</th>
                            <th>Quinta</th>
                            <th>Sexta</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="classReportModal" class="modal-overlay hidden z-[60]">
        <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-5xl h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">Relat√≥rio Individual: Turma</h3><button onclick="closeReportModal()"
                    class="text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            </div>
            <div class="bg-slate-50 p-4 rounded-lg mb-4 flex gap-4 items-center">
                <select id="reportClassSelect" onchange="updateClassReportTable()"
                    class="p-2 border rounded-lg min-w-[250px]"></select>
                <button onclick="printClassReport()"
                    class="px-4 py-2 bg-slate-800 text-white rounded-lg flex items-center gap-2 hover:bg-slate-900"><i
                        data-lucide="printer" class="w-4 h-4"></i> Imprimir Individual</button>
            </div>
            <div class="flex-1 overflow-auto border rounded-lg">
                <table id="classReportTable" class="w-full text-center">
                    <thead>
                        <tr class="bg-slate-100 text-slate-600 text-sm uppercase">
                            <th>Hor√°rio</th>
                            <th>Segunda</th>
                            <th>Ter√ßa</th>
                            <th>Quarta</th>
                            <th>Quinta</th>
                            <th>Sexta</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="js/complete.js"></script>

</body>

</html>